@page "/app/timesheet/"
@page "/app/timesheet/{SelectedDate:datetime}"
@attribute [Authorize]

@using Quarter.Components
@using Quarter.Core.Utils
@using Quarter.State

<ApplicationPage>
    <PageContent>
        <PageColumns>
            <ContextContent>
                <CalendarWidget SelectedDate="SelectedDate" LinkGeneratorFn="@Page.Timesheet"/>
                <TimesheetSummaryWidget/>
            </ContextContent>
        <MainContent>
            <TimesheetGrid/>
        </MainContent>
        <ToolbarContent>
            <TimesheetActivitySelectorWidget/>
        </ToolbarContent>
        </PageColumns>
    </PageContent>
</ApplicationPage>

@inherits Quarter.Core.UI.Components.QuarterComponent<Quarter.State.ApplicationState>

@code {
    [Parameter]
    public DateTime? SelectedDate { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
        SelectedDate ??= DateTime.UtcNow.Date;

        await DispatchAsync(new LoadProjects());
        await DispatchAsync(new LoadTimesheetAction(new Date(SelectedDate.Value)));
    }
}